#!/usr/bin/env bash
# mise description="Build Flutter web app for production deployment (with git version info)"

set -euo pipefail

echo "Building Flutter web app for production..."

# Get version information
if [ -x "scripts/get_version_info.sh" ]; then
  echo "Gathering version information..."
  eval "$(scripts/get_version_info.sh export)"
else
  echo "Warning: scripts/get_version_info.sh not found, building without version info"
fi

# Build with version information
flutter build web --release --base-href "/" \
  ${GIT_TAG:+--dart-define=GIT_TAG=$GIT_TAG} \
  ${GIT_COMMIT:+--dart-define=GIT_COMMIT=$GIT_COMMIT} \
  ${GIT_BRANCH:+--dart-define=GIT_BRANCH=$GIT_BRANCH} \
  ${BUILD_VERSION:+--dart-define=BUILD_VERSION=$BUILD_VERSION} \
  ${BUILD_TIME:+--dart-define=BUILD_TIME=$BUILD_TIME}

echo ""
echo "âœ… Production build complete! Output at: build/web/"
echo ""
echo "Version info:"
echo "  Tag: ${GIT_TAG:-N/A}"
echo "  Commit: ${GIT_COMMIT:-N/A}"
echo "  Branch: ${GIT_BRANCH:-N/A}"
